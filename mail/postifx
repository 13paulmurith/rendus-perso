FROM debian:9.6

RUN apt-get update -q -q && \
 apt-get --yes --force-yes install postfix && \
apt-get --yes --force-yes --no-install-recommends install rsyslog

RUN echo mail > /etc/hostname
ADD etc-hosts.txt /etc/hosts
RUN chown root:root /etc/hosts

RUN echo postfix postfix/main_mailer_type string "'Internet Site'" | debconf-set-selections && \
 echo postfix postfix/mynetworks string "127.0.0.0/8" | debconf-set-selections && \
 echo postfix postfix/mailname string postfix.panz.ovh | debconf-set-selections

RUN \
postconf -e inet_interfaces="loopback-only" &&\
postconf -e myhostname="postfix.panz.ovh" &&\
postconf -e mydestination="$myhostname, panz.ovh, localhost.postfix.panz.ovh, localhost.localdomain" &&\
postconf -e inet_protocols=ipv4 &&\
postconf -e mail_spool_directory="/var/spool/mail" &&\
postconf -e mailbox_command=""

RUN useradd -s /bin/bash admin
RUN mkdir /var/spool/mail/admin
RUN chown admin:mail /var/spool/mail/admin

ADD etc-aliases.txt /etc/aliases
RUN chown root:root /etc/aliases
RUN newaliases

RUN apt-get install -q -y syslog-ng

EXPOSE 25

CMD ["sh", "-c", "service syslog-ng start ; service postfix start ; tail -F /var/log/mail.log"]
